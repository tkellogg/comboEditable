/*
 comboEditable.js

 Copyright 2011, Tim Kellogg
 Dual licensed under the MIT or GPL version 2

 https://github.com/tkellogg/comboEditable
*/
(function(b){var h=2,e=b.browser.msie?"22px":"20px",f=function(a,c){this.el=a;this.name=a.attr("name")?a.attr("name"):"";this.selectedText=this.selectedValue=null;this.elements=this.getOptionValues(a.find("option"));this.$ret=b("<div/>").css({display:a.css("display"),width:a.width()});this.opts=this.processOptions(c,a)};b.extend(f.prototype,{processOptions:function(a){var b={};if(a&&a.mode==="text")b.valueAsText=!0;return b},getOptionValues:function(){var a=this._mapOptionsToElements();if(!this.selectedText)this.selectedValue=
this.el.find("option").first().val(),this.selectedText=this.el.find("option").first().text();var c="";b.each(a,function(a,b){c+=b});return c},_mapOptionsToElements:function(){return b.map(this.el.find("option"),b.proxy(function(a){if(a.selected)this.selectedValue=a.value,this.selectedText=a.innerHTML;return'<div class="ui-state-default" data-value="'+a.value+'" '+ +(a.selected?NaN:0)+">"+a.innerHTML+"</div>"},this))},makeTextBox:function(){var a=this.$ret.append("<div/>").children().first();a.css({position:"relative"});
var c=b("<table><tr><td/></tr></table>"),g=c.find("td");g.append('<input type="text" value="'+this.selectedText+'" name="text-'+this.name+'" />');this.$text=g.find(":text").css({display:"inline",width:this.el.width()-20});a.append(c);this.$textWrap=a},makeIcon:function(){this.$textWrap.append("<div/>");this.$button=b('<div class="ui-icon ui-icon-triangle-1-s ui-state-default ui-corner-right"/>').css({height:e,width:e});b("<td/>").append(this.$button).appendTo(this.$textWrap.find("tr"));this.$textWrap.find("td").css("padding",
"0px 0px 0px 0px")},addHiddenField:function(){this.$ret.append('<input type="hidden" value="'+this.selectedValue+'" name="'+this.name+'" />');this.$value=this.$ret.find('input[type="hidden"]')},stylizeOptions:function(){this.$ret.append('<div class="ui-combo-editable-options"/>');var a=this.$ret.find("div.ui-combo-editable-options");a.append(this.elements);a.css({"z-index":1,position:"absolute"});a.find("div").css({display:"block",cursor:"default"}).hover(function(){b(this).addClass("ui-state-hover")},
function(){b(this).removeClass("ui-state-hover")}).css({width:this.el.width()});this.$options=a},stylizeIcon:function(){var a=this.$options;a.hide();this.$button.click(function(){a.is(":visible")?a.hide():a.show()}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")})},wireupHideActions:function(){var a=this.$options;this.$ret.blur(function(){a.hide()}).attr("tabindex","0").css({outline:"none"});this.$ret.keyup(function(b){b.which===27&&a.hide()});
var c=this;a.find("div").click(function(){a.hide();c.$text.val(b(this).text());c.$value.val(b(this).data("data-value"))})},setFormValues:function(){this.opts.valueAsText||(this.$options.find("div").click(b.proxy(function(a){this.$value.val(b(a.target).attr("data-value"))},this)),this.$text.keyup(b.proxy(function(){this.$value.val(void 0)},this)))},stretchIcon:function(){function a(a){var d=b.css("background-position-"+a);d&&(d=parseInt(d.replace(/(-?\d+)px/,"$1")),b.css("background-position-"+a,d+
h+"px"))}var b=this.$button;a("x");a("y")}});b.fn.comboEditable=function(a){a=new f(this,a);a.makeTextBox();a.makeIcon();a.addHiddenField();a.stylizeOptions();a.stylizeIcon();a.wireupHideActions();a.setFormValues();var c=this.attr("id");this.replaceWith(a.$ret);a.$text.attr("id",c);b(".ui-icon-triangle-1-s").css("background-position","-62px -14px");return a.$ret}})(jQuery);

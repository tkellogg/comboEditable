/*
 comboEditable.js

 Copyright 2011, Tim Kellogg
 Dual licensed under the MIT or GPL version 2

 https://github.com/tkellogg/comboEditable
*/
(function(b){var d=function(a){this.el=a;this.name=a.attr("name")?a.attr("name"):"";this.selectedText=this.selectedValue=null;this.elements=this.getOptionValues(a.find("option"));this.$ret=b("<div/>")};b.extend(d.prototype,{getOptionValues:function(){var a=this._mapOptionsToElements();if(!this.selectedText)this.selectedValue=this.el.find("option").first().val(),this.selectedText=this.el.find("option").first().text();var c="";b.each(a,function(a,b){c+=b});return c},_mapOptionsToElements:function(){return b.map(this.el.find("option"),
b.proxy(function(a){if(a.selected)this.selectedValue=a.value,this.selectedText=a.innerHTML;return'<div class="ui-state-default" data-value="'+a.value+'" '+ +(a.selected?NaN:0)+">"+a.innerHTML+"</div>"},this))},makeTextBox:function(){var a=this.$ret.append("<div/>").children().first();a.css({position:"relative"});a.append('<input type="text" value="'+this.selectedText+'" />');this.$text=a.find(":text").css({display:"inline",width:this.el.width()});this.$textWrap=a},makeIcon:function(){this.$textWrap.append("<div/>");
this.$button=this.$textWrap.find("div").addClass("ui-icon ui-icon-carat-1-s ui-state-default").css({margin:"1px 1px 1px 1px"});this.$button.wrap("<div/>").parent().addClass("ui-state-default").css({position:"relative",top:"2px",right:"1px"}).wrap("<div/>").parent().css({display:"inline",position:"absolute"})},addHiddenField:function(){this.$ret.append('<input type="hidden" value="'+this.selectedValue+'" name="'+this.name+'" />');this.$value=this.$ret.find('input[type="hidden"]')},stylizeOptions:function(){this.$ret.append('<div class="ui-combo-editable-options"/>');
var a=this.$ret.find("div.ui-combo-editable-options");a.append(this.elements);a.find("div").css({display:"block",cursor:"default"}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")}).css({width:this.el.width()});this.$options=a},stylizeIcon:function(){var a=this.$options;a.hide();this.$button.click(function(){a.is(":visible")?a.hide():a.show()}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")})},
wireupHideActions:function(){var a=this.$options;this.$ret.blur(function(){a.hide()}).attr("tabindex","999").css({outline:"none"});this.$ret.keyup(function(b){b.which===27&&a.hide()});var c=this;a.find("div").click(function(){a.hide();c.$text.val(b(this).text());c.$value.val(b(this).data("data-value"))})}});b.fn.comboEditable=function(){var a=new d(this);a.makeTextBox();a.makeIcon();a.addHiddenField();a.stylizeOptions();a.stylizeIcon();a.wireupHideActions();var b=this.attr("id");this.replaceWith(a.$ret);
a.$text.attr("id",b);return a.$ret}})(jQuery);
